(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{6698:function(e,r,t){Promise.resolve().then(t.bind(t,5344))},5344:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return h}});var a=t(7437),s=t(2265),o=t(6463),l=t(2234),n=t(7440),i=t(74),c=t(357);function d(e){let{onSuccess:r,onError:t,customerInfo:s}=e,{items:o,getTotalPrice:n}=(0,l.j)(),[{isPending:c}]=(0,i.Up)(),d=async()=>{try{let e=await fetch("/api/payments/paypal",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:n(),currency:"EUR",items:o.map(e=>({name:e.product.name,quantity:e.quantity,price:e.product.price})),customerInfo:s})}),r=await e.json();if(r.success)return r.orderId;throw Error(r.error||"Failed to create PayPal order")}catch(e){throw console.error("PayPal order creation error:",e),t(e instanceof Error?e.message:"Payment failed"),e}},m=async e=>{try{r(e.orderID)}catch(e){console.error("PayPal approval error:",e),t("Payment approval failed")}};return c?(0,a.jsx)("div",{className:"text-center py-4 text-gray-mid",children:"Lade PayPal..."}):(0,a.jsx)(i.ch,{createOrder:d,onApprove:m,onError:e=>{console.error("PayPal error:",e),t("PayPal payment failed")},style:{layout:"vertical",color:"gold",shape:"rect",label:"paypal"}})}function m(e){let{onSuccess:r,onError:t,customerInfo:s}=e,o=c.env.NEXT_PUBLIC_PAYPAL_CLIENT_ID||"";return o?(0,a.jsx)(i.Vv,{options:{clientId:o,currency:"EUR",intent:"capture"},children:(0,a.jsx)(d,{onSuccess:r,onError:t,customerInfo:s})}):(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-eco p-4 text-sm text-yellow-800",children:"PayPal Client ID nicht konfiguriert. Bitte setze NEXT_PUBLIC_PAYPAL_CLIENT_ID in deiner .env Datei."})}var u=t(9787),p=t(357);function f(e){let{onSuccess:r,onError:t,customerInfo:o}=e,{items:i,getTotalPrice:c}=(0,l.j)(),[d,m]=(0,s.useState)(!1),f=async()=>{m(!0);try{let e=window.location.origin,r=await fetch("/api/payments/mollie",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:c(),currency:"EUR",description:"EcoSpark Bestellung - ".concat(i.length," Artikel"),redirectUrl:"".concat(e,"/payments/success"),webhookUrl:"".concat(p.env.NEXT_PUBLIC_APP_URL||e,"/api/payments/mollie/webhook"),metadata:{orderItems:i.map(e=>({id:e.product.id,name:e.product.name,quantity:e.quantity,price:e.product.price})),customer:o}})}),t=await r.json();if(t.success&&t.paymentUrl)window.location.href=t.paymentUrl;else throw Error(t.error||"Failed to create Mollie payment")}catch(e){console.error("Mollie payment error:",e),m(!1),t(e instanceof Error?e.message:"Payment failed")}};return(0,a.jsx)(u.Z,{variant:"primary",onClick:f,disabled:d,className:"w-full bg-deep-forest hover:bg-opacity-90",children:d?"Wird verarbeitet...":"Mit Kreditkarte zahlen (".concat((0,n.T)(c()),")")})}function h(){let e=(0,o.useRouter)(),{items:r,getTotalPrice:t,clearCart:i}=(0,l.j)(),[c,d]=(0,s.useState)({firstName:"",lastName:"",email:"",address:"",city:"",postalCode:"",country:"Deutschland"}),[u,p]=(0,s.useState)(null),[h,x]=(0,s.useState)(!1);if(0===r.length)return e.push("/cart"),null;let g=async(a,s)=>{x(!0);let o={paymentId:a,provider:s,items:r,customerInfo:c,total:t(),date:new Date().toISOString()};try{let e=JSON.parse(localStorage.getItem("ecospark-orders")||"[]");e.push(o),localStorage.setItem("ecospark-orders",JSON.stringify(e))}catch(e){console.error("Error saving order to localStorage:",e)}i(),e.push("/payments/success?paymentId=".concat(a,"&provider=").concat(s))},y=e=>{x(!1),alert("Zahlungsfehler: ".concat(e))};return(0,a.jsxs)("div",{className:"container mx-auto px-4 py-12",children:[(0,a.jsx)("h1",{className:"font-heading text-4xl font-bold text-deep-forest mb-8",children:"Checkout"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,a.jsxs)("form",{className:"bg-white rounded-eco border border-gray-low p-6 space-y-6",children:[(0,a.jsx)("h2",{className:"font-heading text-2xl font-bold text-deep-forest mb-4",children:"Lieferadresse"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"firstName",className:"block text-sm font-semibold text-deep-forest mb-2",children:"Vorname *"}),(0,a.jsx)("input",{type:"text",id:"firstName",required:!0,value:c.firstName,onChange:e=>d({...c,firstName:e.target.value}),className:"w-full px-4 py-2 border border-gray-low rounded-eco focus:outline-none focus:ring-2 focus:ring-leaf-green"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"lastName",className:"block text-sm font-semibold text-deep-forest mb-2",children:"Nachname *"}),(0,a.jsx)("input",{type:"text",id:"lastName",required:!0,value:c.lastName,onChange:e=>d({...c,lastName:e.target.value}),className:"w-full px-4 py-2 border border-gray-low rounded-eco focus:outline-none focus:ring-2 focus:ring-leaf-green"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-semibold text-deep-forest mb-2",children:"E-Mail-Adresse *"}),(0,a.jsx)("input",{type:"email",id:"email",required:!0,value:c.email,onChange:e=>d({...c,email:e.target.value}),className:"w-full px-4 py-2 border border-gray-low rounded-eco focus:outline-none focus:ring-2 focus:ring-leaf-green"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"address",className:"block text-sm font-semibold text-deep-forest mb-2",children:"Stra\xdfe und Hausnummer *"}),(0,a.jsx)("input",{type:"text",id:"address",required:!0,value:c.address,onChange:e=>d({...c,address:e.target.value}),className:"w-full px-4 py-2 border border-gray-low rounded-eco focus:outline-none focus:ring-2 focus:ring-leaf-green"})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{htmlFor:"city",className:"block text-sm font-semibold text-deep-forest mb-2",children:"Stadt *"}),(0,a.jsx)("input",{type:"text",id:"city",required:!0,value:c.city,onChange:e=>d({...c,city:e.target.value}),className:"w-full px-4 py-2 border border-gray-low rounded-eco focus:outline-none focus:ring-2 focus:ring-leaf-green"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"postalCode",className:"block text-sm font-semibold text-deep-forest mb-2",children:"PLZ *"}),(0,a.jsx)("input",{type:"text",id:"postalCode",required:!0,value:c.postalCode,onChange:e=>d({...c,postalCode:e.target.value}),className:"w-full px-4 py-2 border border-gray-low rounded-eco focus:outline-none focus:ring-2 focus:ring-leaf-green"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"country",className:"block text-sm font-semibold text-deep-forest mb-2",children:"Land *"}),(0,a.jsxs)("select",{id:"country",required:!0,value:c.country,onChange:e=>d({...c,country:e.target.value}),className:"w-full px-4 py-2 border border-gray-low rounded-eco focus:outline-none focus:ring-2 focus:ring-leaf-green",children:[(0,a.jsx)("option",{value:"Deutschland",children:"Deutschland"}),(0,a.jsx)("option",{value:"\xd6sterreich",children:"\xd6sterreich"}),(0,a.jsx)("option",{value:"Schweiz",children:"Schweiz"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-eco border border-gray-low p-6",children:[(0,a.jsx)("h2",{className:"font-heading text-2xl font-bold text-deep-forest mb-4",children:"Zahlungsmethode"}),!(c.firstName&&c.lastName&&c.email&&c.address&&c.city&&c.postalCode)&&(0,a.jsx)("p",{className:"text-sm text-gray-mid mb-4",children:"Bitte f\xfclle zuerst die Lieferadresse aus."}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"border border-gray-low rounded-eco p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("input",{type:"radio",id:"paypal",name:"payment",value:"paypal",checked:"paypal"===u,onChange:()=>p("paypal"),disabled:!(c.firstName&&c.lastName&&c.email&&c.address&&c.city&&c.postalCode),className:"w-4 h-4 text-leaf-green focus:ring-leaf-green"}),(0,a.jsx)("label",{htmlFor:"paypal",className:"font-heading font-semibold text-deep-forest cursor-pointer",children:"PayPal"})]}),(0,a.jsx)("img",{src:"https://www.paypalobjects.com/webstatic/mktg/logo/pp_cc_mark_111x69.jpg",alt:"PayPal",className:"h-8"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-mid mb-3",children:"Bezahle sicher mit PayPal oder Kreditkarte"}),"paypal"===u&&c.firstName&&c.lastName&&c.email&&c.address&&c.city&&c.postalCode&&(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(m,{onSuccess:e=>g(e,"paypal"),onError:y,customerInfo:c})})]}),(0,a.jsxs)("div",{className:"border border-gray-low rounded-eco p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("input",{type:"radio",id:"mollie",name:"payment",value:"mollie",checked:"mollie"===u,onChange:()=>p("mollie"),disabled:!(c.firstName&&c.lastName&&c.email&&c.address&&c.city&&c.postalCode),className:"w-4 h-4 text-leaf-green focus:ring-leaf-green"}),(0,a.jsx)("label",{htmlFor:"mollie",className:"font-heading font-semibold text-deep-forest cursor-pointer",children:"Kreditkarte (VISA, Mastercard)"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("img",{src:"https://www.visa.com/dam/VCOM/regional/ve/romania/blogs/hero-image/visa-logo-800x450.jpg",alt:"VISA",className:"h-6"}),(0,a.jsx)("img",{src:"https://brand.mastercard.com/content/dam/mccom/brandcenter/thumbnails/mastercard_vrt_rev_92px_2x.png",alt:"Mastercard",className:"h-6"})]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-mid mb-3",children:"Sichere Zahlung mit Kreditkarte \xfcber Mollie"}),"mollie"===u&&c.firstName&&c.lastName&&c.email&&c.address&&c.city&&c.postalCode&&(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(f,{onSuccess:e=>g(e,"mollie"),onError:y,customerInfo:c})})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-mid mt-4",children:"* Alle Zahlungen werden sicher verarbeitet. Deine Zahlungsdaten werden verschl\xfcsselt \xfcbertragen."})]})]}),(0,a.jsx)("div",{className:"md:col-span-1",children:(0,a.jsxs)("div",{className:"bg-white rounded-eco border border-gray-low p-6 sticky top-24",children:[(0,a.jsx)("h2",{className:"font-heading text-xl font-bold text-deep-forest mb-4",children:"Bestell\xfcbersicht"}),(0,a.jsxs)("div",{className:"space-y-3 mb-6",children:[r.map(e=>(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsxs)("span",{className:"text-graphite",children:[e.product.name," \xd7 ",e.quantity]}),(0,a.jsx)("span",{className:"text-graphite",children:(0,n.T)(e.product.price*e.quantity)})]},e.product.id)),(0,a.jsxs)("div",{className:"border-t border-gray-low pt-3 flex justify-between",children:[(0,a.jsx)("span",{className:"font-heading font-bold text-deep-forest",children:"Gesamt"}),(0,a.jsx)("span",{className:"font-heading font-bold text-deep-forest",children:(0,n.T)(t())})]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-mid space-y-1",children:[(0,a.jsx)("p",{children:"✓ Kostenloser Versand"}),(0,a.jsx)("p",{children:"✓ 14 Tage Widerrufsrecht"}),(0,a.jsx)("p",{children:"✓ Sichere Zahlung"})]})]})})]})]})}},9787:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});var a=t(7437);function s(e){let{variant:r="primary",children:t,className:s="",...o}=e;return(0,a.jsx)("button",{className:"".concat("px-6 py-3 rounded-eco font-body font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-deep-forest text-white hover:bg-opacity-90 focus:ring-leaf-green",secondary:"border border-leaf-green bg-transparent text-deep-forest hover:bg-soft-mint focus:ring-leaf-green"}[r]," ").concat(s),...o,children:t})}t(2265)},2234:function(e,r,t){"use strict";t.d(r,{CartProvider:function(){return l},j:function(){return n}});var a=t(7437),s=t(2265);let o=(0,s.createContext)(void 0);function l(e){let{children:r}=e,[t,l]=(0,s.useState)([]),[n,i]=(0,s.useState)(!1);(0,s.useEffect)(()=>{i(!0);let e=localStorage.getItem("ecospark-cart");if(e)try{l(JSON.parse(e))}catch(e){console.error("Error loading cart from localStorage:",e)}},[]),(0,s.useEffect)(()=>{n&&localStorage.setItem("ecospark-cart",JSON.stringify(t))},[t,n]);let c=e=>{l(r=>r.filter(r=>r.product.id!==e))};return(0,a.jsx)(o.Provider,{value:{items:t,addToCart:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;l(t=>t.find(r=>r.product.id===e.id)?t.map(t=>t.product.id===e.id?{...t,quantity:t.quantity+r}:t):[...t,{product:e,quantity:r}])},removeFromCart:c,updateQuantity:(e,r)=>{if(r<=0){c(e);return}l(t=>t.map(t=>t.product.id===e?{...t,quantity:r}:t))},clearCart:()=>{l([])},getTotalPrice:()=>t.reduce((e,r)=>e+r.product.price*r.quantity,0),getTotalItems:()=>t.reduce((e,r)=>e+r.quantity,0)},children:r})}function n(){let e=(0,s.useContext)(o);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},7440:function(e,r,t){"use strict";function a(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e)}t.d(r,{T:function(){return a}})}},function(e){e.O(0,[544,971,23,744],function(){return e(e.s=6698)}),_N_E=e.O()}]);